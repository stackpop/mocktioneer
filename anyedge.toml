[app]
name = "mocktioneer"
entry = "crates/mocktioneer-core"
middleware = [
  "anyedge_core::middleware::RequestLogger",
  "mocktioneer_core::routes::Cors"
]

[[triggers.http]]
id = "root"
path = "/"
methods = ["GET"]
handler = "mocktioneer_core::routes::handle_root"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "root_options"
path = "/"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "openrtb_auction"
path = "/openrtb2/auction"
methods = ["POST"]
handler = "mocktioneer_core::routes::handle_openrtb_auction"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "openrtb_options"
path = "/openrtb2/auction"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "static_img"
path = "/static/img/{size}"
methods = ["GET"]
handler = "mocktioneer_core::routes::handle_static_img"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "static_img_options"
path = "/static/img/{size}"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "static_creatives"
path = "/static/creatives/{size}"
methods = ["GET"]
handler = "mocktioneer_core::routes::handle_static_creatives"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "static_creatives_options"
path = "/static/creatives/{size}"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "click"
path = "/click"
methods = ["GET"]
handler = "mocktioneer_core::routes::handle_click"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "click_options"
path = "/click"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "pixel"
path = "/pixel"
methods = ["GET"]
handler = "mocktioneer_core::routes::handle_pixel"
adapters = ["fastly", "cloudflare"]

[[triggers.http]]
id = "pixel_options"
path = "/pixel"
methods = ["OPTIONS"]
handler = "mocktioneer_core::routes::handle_options"
adapters = ["fastly", "cloudflare"]

[adapters.fastly.adapter]
crate = "crates/mocktioneer-adapter-fastly"
manifest = "crates/mocktioneer-adapter-fastly/fastly.toml"

[adapters.fastly.build]
target = "wasm32-wasip1"
profile = "release"
features = ["fastly"]

[adapters.fastly.commands]
build = "cargo build --release --target wasm32-wasip1 -p mocktioneer-adapter-fastly"
serve = "fastly compute serve -C crates/mocktioneer-adapter-fastly"
deploy = "fastly compute deploy -C crates/mocktioneer-adapter-fastly"

[adapters.cloudflare.adapter]
crate = "crates/mocktioneer-adapter-cloudflare"
manifest = "crates/mocktioneer-adapter-cloudflare/wrangler.toml"

[adapters.cloudflare.build]
target = "wasm32-unknown-unknown"
profile = "release"
features = ["cloudflare"]

[adapters.cloudflare.commands]
build = "cargo build --release --target wasm32-unknown-unknown -p mocktioneer-adapter-cloudflare"
serve = "wrangler dev --config crates/mocktioneer-adapter-cloudflare/wrangler.toml"
deploy = "wrangler publish --config crates/mocktioneer-adapter-cloudflare/wrangler.toml"

[logging.fastly]
endpoint = "mocktioneerlog"
level = "info"
echo_stdout = false

[logging.cloudflare]
level = "info"
